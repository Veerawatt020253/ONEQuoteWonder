<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shuffle ME</title>

    <!-- fav icon -->
    <link rel="shortcut icon" href="./img/brainrot.jpg" type="image/x-icon" />

    <!-- font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- sweetalert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- html2canvas for image capture -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- css -->
    <link rel="stylesheet" href="style.css" />
  </head>

  <body class="bg-[#F9F9F9] bg-[url(./img/bg.png)]">
    <main class="m-3 mt-[15%]">
      <div id="main">
        <div class="text-center">
          <h1 class="text-[#6984C9] text-3xl">Quote From The God</h1>
        </div>

        <div class="space-y-6 text-center mt-10">
          <!-- Dropdown -->
          <div>
            <select
              class="px-4 py-2 rounded-full border-2 shadow-md font-semibold focus:outline-none border-[#6984C9] dropdown-options"
            >
              <option>Category</option>
            </select>
          </div>

          <!-- Card Stack -->
          <div id="quote-card" class="relative w-80 h-96 mx-auto">
            <div
              class="absolute top-4 left-4 w-full h-full rounded-xl bg-red-200 z-0"
            ></div>
            <div
              class="absolute top-2 left-2 w-full h-full rounded-xl bg-green-200 z-10"
            ></div>
            <div
              class="relative w-full h-full bg-yellow-100 rounded-xl border-2 border-black shadow-lg flex items-center justify-center z-20 p-4 overflow-hidden"
            >
              <p
                class="text-lg font-semibold text-center text-black overflow-hidden text-ellipsis break-words"
              >
                <span
                  class="border-b-4 border-black px-2 block overflow-hidden break-words"
                >
                  “ <span id="text">Press Shuffle</span> ”
                </span>
              </p>
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex items-center justify-center gap-6 mt-[10%]">
            <button
              id="shuffleBtn"
              class="flex items-center gap-2 px-4 py-2 rounded-full border-2 border-[#6984C9] hover:bg-[#6984C9] transition"
            >
              <i class="fa-solid fa-arrows-rotate"></i> Shuffle
            </button>

            <button
              id="shareBtn"
              class="p-3 rounded-full border-2 border-[#6984C9] hover:bg-[#6984C9] transition py-2"
            >
              <i class="fa-solid fa-share-nodes"></i>
            </button>

            <button
              id="downloadBtn"
              class="p-3 rounded-full border-2 border-[#6984C9] hover:bg-[#6984C9] transition py-2"
            >
              <i class="fa-solid fa-download"></i>
            </button>
          </div>
        </div>
    </div>

        <!-- Submission Section -->
        <div class="flex flex-col justify-between items-center p-6">
          <div class="text-center mt-8">
            <h1 class="text-2xl font-bold text-black">Submission</h1>
          </div>

          <div class="mt-6">
            <select
              class="px-4 py-2 rounded-full border-2 shadow-md font-semibold focus:outline-none border-[#6984C9] dropdown-options"
            >
              <option>Category</option>
            </select>
          </div>

          <div
            class="w-80 h-96 bg-white rounded-xl border-2 border-black shadow-lg flex items-center justify-center mt-6"
          >
            <div class="relative flex items-center">
              <span class="text-3xl font-semibold text-black mr-2">“</span>
              <input
                type="text"
                placeholder="Enter quote"
                id="quoteinput"
                class="text-2xl font-semibold text-black text-center border-b-4 border-black px-4 py-1 focus:outline-none bg-transparent w-52"
              />
              <span class="text-3xl font-semibold text-black ml-2">”</span>
            </div>
          </div>

          <button
            id="send"
            class="mt-10 mb-6 p-3 px-4 rounded-full border-2 border-[#6984C9] hover:bg-blue-100 transition"
          >
            <i class="fas fa-paper-plane text-xl text-black"></i>
          </button>
        </div>
      </div>
    </main>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyBtAtawjLDrG5LBAKBlzGYKnJieVBCgcbg",
        authDomain: "shuffleme-398dc.firebaseapp.com",
        projectId: "shuffleme-398dc",
        storageBucket: "shuffleme-398dc.appspot.com",
        messagingSenderId: "950272443337",
        appId: "1:950272443337:web:8485b0b4db1f703eae1e18",
      };

      // Init Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // DOM Elements
      const sendBtn = document.getElementById("send");
      const quoteInput = document.getElementById("quoteinput");
      const textDisplay = document.getElementById("text");
      const shuffleBtn = document.getElementById("shuffleBtn");
      const shareBtn = document.getElementById("shareBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      // แคปเฉพาะ quote card
      const target = document.getElementById("main");

      // === FIREBASE SUBMIT ===
      sendBtn.addEventListener("click", async () => {
        const quote = quoteInput.value.trim();
        if (quote) {
          await addDoc(collection(db, "quote"), { quote });
          quoteInput.value = "";
          Swal.fire("Added!", "Quote submitted successfully!", "success");
        } else {
          Swal.fire("Error!", "Please enter a quote.", "error");
        }
      });

      // === SHUFFLE QUOTE ===
      async function loadQuotes() {
        const querySnapshot = await getDocs(collection(db, "quote"));
        const quotes = [];
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          if (data.quote) quotes.push(data.quote);
        });

        if (quotes.length > 0) {
          const randomIndex = Math.floor(Math.random() * quotes.length);
          textDisplay.textContent = quotes[randomIndex];
        } else {
          textDisplay.textContent = "No quotes found.";
        }
      }

      shuffleBtn.addEventListener("click", loadQuotes);

      // === SHARE SCREEN ===
      shareBtn.addEventListener("click", async () => {
        html2canvas(target).then(async (canvas) => {
          canvas.toBlob(async (blob) => {
            const file = new File([blob], "quote.png", { type: "image/png" });

            if (navigator.canShare && navigator.canShare({ files: [file] })) {
              try {
                await navigator.share({
                  files: [file],
                  title: "My Quote from ShuffleMe",
                  text: "Check out this awesome quote!",
                });
              } catch (err) {
                Swal.fire("Error", "Sharing was canceled or failed.", "error");
              }
            } else {
              Swal.fire(
                "Unsupported",
                "Sharing not supported on this device.",
                "warning"
              );
            }
          });
        });
      });

      // === DOWNLOAD SCREEN ===
      downloadBtn.addEventListener("click", () => {
        html2canvas(target).then((canvas) => {
          const link = document.createElement("a");
          link.download = "quote.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        });
      });
    </script>
  </body>
</html>
